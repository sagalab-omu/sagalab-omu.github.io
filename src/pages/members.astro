---

import Layout from '~/layouts/PageLayout.astro';
import HeroText from '~/components/widgets/HeroText.astro';
import MembersWidget from '~/components/widgets/Members.astro';
import Graduate from '~/components/widgets/Graduate.astro';

// Load all data sources at build time
const labData = await import('../data/lab.json').catch(() => ({
  default: {
    name: 'Our Laboratory',
    tagline: 'Advancing knowledge through innovative research',
    description: 'We are dedicated to pushing the boundaries of scientific discovery through cutting-edge research and collaboration.',
    banner: '/images/lab/banner.jpg',
    email: 'info@example.com',
    location: 'Osaka, Japan'
  }
}));

const memberFiles = import.meta.glob('../data/members/*.json', { eager: true });

const lab = labData.default;

interface Member {
  name: string;
  role: string;
  bio: string;
  photo: string;
  github: string;
  "research-area": string[];
}

const members: Member[] = Object.values(memberFiles).map((file: { default: Member }) => file.default);

console.log('Members loaded:', members);

const metadata = {
  title: 'Members',
  description: lab.description,
  canonical: '/members',
};
---

<Layout metadata={metadata}>
  <section id="member" class="mx-auto max-w-6xl">
    <HeroText tagline="team member" title="チームメンバー" subtitle="私たちの研究室は、国際的なメンバーで構成されています。"/>
    <MembersWidget
      members={members}
    >
      <Fragment slot="bg">
        <div class="absolute inset-0 bg-gray-50 dark:bg-gray-950"></div>
      </Fragment>
    </MembersWidget>
  </section>
  <section id="graduates" class="mx-auto max-w-6xl">
    <Graduate title="卒業生" subtitle="私たちの研究室を卒業したメンバー一覧です。" tagline="Graduates"/>
  </section>
</Layout>
